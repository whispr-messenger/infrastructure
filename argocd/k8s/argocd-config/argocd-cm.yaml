---
# General Argo CD configuration
apiVersion: v1
kind: ConfigMap
metadata:
  name: argocd-cm
  namespace: argocd
  labels:
    app.kubernetes.io/name: argocd-cm
    app.kubernetes.io/part-of: argocd
data:
  # Argo CD's externally facing base URL (optional). Required when configuring SSO
  url: https://argocd.whispr.fr
  # Enables application status badge feature
  statusbadge.enabled: "true"
  # Enable insecure mode for server (will be terminated by ingress)
  server.insecure: "true"
  # Application instance label key
  application.instanceLabelKey: argocd.argoproj.io/instance
  
  # Dex configuration for GitHub OAuth (following best practices article)
  dex.config: |
    connectors:
    - type: github
      id: github
      name: GitHub
      config:
        baseURL: https://github.com
        clientID: $dex.github.clientId
        clientSecret: $dex.github.clientSecret
        redirectURI: https://argocd.whispr.fr/api/dex/callback
        orgs:
        - name: whispr-messenger
          # Remove teams restriction to allow all org members